# 기본_화면_설계_V0.2.1.md
(Personal Investment Portfolio · SSOT)

본 문서는 **PIP(Personal Investment Portfolio)** 프로젝트의
모든 화면·업무·데이터 흐름에 대한 **최상위 설계 문서(헌법)**이다.

이 문서는 개별 화면 SSOT를 작성하기 위한 **기준점** 역할을 하며,
하위 문서(Model / UI / API / DB)는 본 문서를 벗어날 수 없다.

---

## 1. 프로젝트 개요

- 목적: 엑셀로 관리하던 개인 투자 포트폴리오를 웹 기반으로 전환
- 특징
  - 단일 원장(Activity = Transaction) 기반
  - 화면 중심 설계(Screen-first)
  - 입력 / 계산 / 시각화 책임 분리

---

## 2. 화면 / SSOT 네이밍 규칙 (NON-NEGOTIABLE)

```
[PROJECT][DOMAIN][TYPE][SEQ]
```

- PROJECT: `PIP`
- DOMAIN: 업무 약어 (ACTLOG, POSHLD, DASH 등)
- TYPE
  - `S` : Screen (화면)
  - `P` : Popup (팝업)
- SEQ
  - `01`, `02`, `03` … 동일 업무 흐름 내 연번

### 예시
- `PIPACTLOGS01` : Activity Log 메인 화면
- `PIPACTLOGP01` : Activity 입력 팝업
- `PIPPOSHLDS01` : Position 목록 화면

📌 모든 설계 문서, 파일명, 코드 식별자는 이 규칙을 따른다.

---

## 3. 핵심 설계 원칙

### 3.1 단일 원장 (Single Ledger)

- 모든 자산 이벤트는 **Activity(Transaction)** 로 기록한다.
- 자산별 / 종목별 개별 시트는 존재하지 않는다.

### 3.2 입력값 vs 계산값 분리

- 입력값
  - 거래일, 수량, 단가, 금액, 통화, 환율
- 계산값
  - 평균단가, 평가금액, 수익률, 환차손익, 원금회수율
- **계산 결과 저장 금지**

### 3.3 통화 및 환율

- 기준 통화: KRW
- 외화 자산 매도 시 → 해당 결제 통화 CASH 증가
- KRW 사용이 필요할 경우 FX(Activity)로 전환한다.
- **FX는 별도 전용 테이블/스냅샷을 만들지 않고, 단일 원장(Activity/Transaction)으로 관리한다.**

---

## 4. 자산 분류 체계

### 4.1 노출(Exposure) 기준

- KR
- US
- JP
- CH
- GLOBAL

📌 국내 상장 ETF라도 **노출 지역 기준으로 집계**한다.

### 4.2 자산 유형

- Stock
- ETF
- Bond
- Crypto
- Commodity (Gold / Silver)
- FX Cash
- KRW Cash

---

## 5. 전체 화면 목록 및 책임

| 화면 | 식별자 | 책임 |
|---|---|---|
| Activity Log | PIPACTLOGS01 | 모든 투자 활동의 단일 원장 입력/관리(매수/매도/배당/이자/입출금/세금/수수료/환전 포함) |
| Asset Master | PIPASSETS01 | 자산(종목) 마스터(참조 데이터) 관리 |
| Position | PIPPOSHLDS01 | 포지션(계좌/자산/현금) 조회 – 원장 기반 계산 결과, 계산값 저장 금지 |
| Dashboard | PIPDASHS01 | 대시보드(요약/시각화) – 계산값 저장 금지, 조회 중심 |
| Exchange | PIPFXS01 | 환전(FX) 관리/입력/조회 |

---

## 6. 화면 간 흐름

```
PIPASSETS01 (자산 마스터 관리)
        ↓
PIPACTLOGS01 / PIPFXS01 (원장 입력)
        ↓
PIPPOSHLDS01 (원장 기반 계산 조회)
        ↓
PIPDASHS01 (요약/시각화 조회)
```

---

## 7. 설계 책임 분리

| 레이어 | 책임 |
|---|---|
| Activity Log | 입력 무결성 |
| Asset Master | 자산 참조 데이터 무결성 |
| Position | 원장 기반 계산 조회 |
| Dashboard | 요약 시각화 조회 |
| FX | 환전 입력/조회 |
| DB | 입력값 저장, 계산값 저장 금지 |

---

## 8. 백엔드 설계 원칙

본 프로젝트의 백엔드 구조는 **화면(ScreenID) 중심 설계**를 따른다.

### 8.1 화면 ↔ 백엔드 1:1 매핑

- 모든 화면(ScreenID)은 전용 백엔드 컴포넌트를 가진다.
- 화면 식별자(ScreenID)는 백엔드 코드의 기본 단위이다.

### 8.2 백엔드 계층 구조

각 화면은 다음 구성요소를 가진다.

- `{SCREENID}Controller`
- `{SCREENID}Service`
- `{SCREENID}Mapper`

예시:
- `PIPACTLOGS01Controller`
- `PIPACTLOGS01Service`
- `PIPACTLOGS01Mapper`

### 8.3 계층별 책임

- Controller
  - HTTP 요청/응답 처리
  - API 계약 준수
- Service
  - 비즈니스 규칙
  - 트랜잭션 경계
- Mapper
  - SQL 전담
  - 계산/비즈니스 로직 금지

📌 ScreenID 없는 Controller / Service / Mapper 생성은 금지한다.

---

본 문서는 **모든 화면 SSOT의 최상위 기준 문서**이며,
변경 시 하위 SSOT 문서를 반드시 재검토해야 한다.
